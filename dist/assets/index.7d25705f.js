var e=Object.defineProperty,r=Object.defineProperties,i=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,o=(r,i,n)=>i in r?e(r,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):r[i]=n,s=(e,r)=>{for(var i in r||(r={}))a.call(r,i)&&o(e,i,r[i]);if(n)for(var i of n(r))t.call(r,i)&&o(e,i,r[i]);return e},c=(e,n)=>r(e,i(n));"undefined"!=typeof require&&require;!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))r(e);new MutationObserver((e=>{for(const i of e)if("childList"===i.type)for(const e of i.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&r(e)})).observe(document,{childList:!0,subtree:!0})}function r(e){if(e.ep)return;e.ep=!0;const r=function(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerpolicy&&(r.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?r.credentials="include":"anonymous"===e.crossorigin?r.credentials="omit":r.credentials="same-origin",r}(e);fetch(e.href,r)}}();var v=(e,r)=>{var i=0;return r.map((r=>{e[i++]=r.x,e[i++]=r.y,e[i++]=r.z})),e},m=(e=0,r=0,i=0)=>({x:e,y:r,z:i}),l=(e,r,i,n)=>(e.x=r,e.y=i,e.z=n,e),d=(e,r)=>(e.x=r,e.y=r,e.z=r,e),y=e=>m(e.x,e.y,e.z),x=(e,r)=>(e.x+=r.x,e.y+=r.y,e.z+=r.z,e),p=(e,r,i)=>(e.x+=r.x*i,e.y+=r.y*i,e.z+=r.z*i,e),u=(e,r)=>(e.x-=r.x,e.y-=r.y,e.z-=r.z,e),h=(e,r,i)=>(e.x=r.x-i.x,e.y=r.y-i.y,e.z=r.z-i.z,e),f=(e,r)=>(e.x*=r.x,e.y*=r.y,e.z*=r.z,e),g=(e,r)=>(e.x*=r,e.y*=r,e.z*=r,e),b=(e,r)=>{var{x:i,y:n,z:a}=e,t=1/(r[3]*i+r[7]*n+r[11]*a+r[15]);return e.x=(r[0]*i+r[4]*n+r[8]*a+r[12])*t,e.y=(r[1]*i+r[5]*n+r[9]*a+r[13])*t,e.z=(r[2]*i+r[6]*n+r[10]*a+r[14])*t,e},w=(e,r)=>{var{x:i,y:n,z:a}=e,t=r.x,o=r.y,s=r.z,c=r.w,v=c*i+o*a-s*n,m=c*n+s*i-t*a,l=c*a+t*n-o*i,d=-t*i-o*n-s*a;return e.x=v*c+d*-t+m*-s-l*-o,e.y=m*c+d*-o+l*-t-v*-s,e.z=l*c+d*-s+v*-o-m*-t,e},z=(e,r)=>g(e,1/r),M=(e,r)=>e.x*r.x+e.y*r.y+e.z*r.z,E=e=>Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z),j=e=>z(e,E(e)||1),R=(e,r)=>g(j(e),r),O=(e,r)=>{var{x:i,y:n,z:a}=e;return e.x=n*r.z-a*r.y,e.y=a*r.x-i*r.z,e.z=i*r.y-n*r.x,e},P=(e,r,i)=>{var n=r.x,a=r.y,t=r.z,o=i.x,s=i.y,c=i.z;return e.x=a*c-t*s,e.y=t*o-n*c,e.z=n*s-a*o,e},F=(e,r)=>Math.sqrt(A(e,r)),A=(e,r)=>{var i=e.x-r.x,n=e.y-r.y,a=e.z-r.z;return i*i+n*n+a*a},T=(e,r)=>(e.x=r[12],e.y=r[13],e.z=r[14],e),C=m(1,0,0),S=m(0,1,0),D=m(0,0,1),_=(e,r,i)=>{var n=M(e,r);return n<0?n*=i:n/=i,p(e,r,-n)},L=m(),I=m(),W=m(),B=()=>new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),k=(e,r,i,n)=>(E(h(W,r,i))||(W.z=1),E(P(L,n,j(W)))||(1===Math.abs(n.z)?W.x+=1e-4:W.z+=1e-4,P(L,n,j(W))),P(I,W,j(L)),e[0]=L.x,e[4]=I.x,e[8]=W.x,e[1]=L.y,e[5]=I.y,e[9]=W.y,e[2]=L.z,e[6]=I.z,e[10]=W.z,e),U=(e,r,i)=>{var[n,a,t,o,s,c,v,m,l,d,y,x,p,u,h,f]=r,[g,b,w,z,M,E,j,R,O,P,F,A,T,C,S,D]=i;return e.set([n*g+s*b+l*w+p*z,a*g+c*b+d*w+u*z,t*g+v*b+y*w+h*z,o*g+m*b+x*w+f*z,n*M+s*E+l*j+p*R,a*M+c*E+d*j+u*R,t*M+v*E+y*j+h*R,o*M+m*E+x*j+f*R,n*O+s*P+l*F+p*A,a*O+c*P+d*F+u*A,t*O+v*P+y*F+h*A,o*O+m*P+x*F+f*A,n*T+s*C+l*S+p*D,a*T+c*C+d*S+u*D,t*T+v*C+y*S+h*D,o*T+m*C+x*S+f*D]),e},N=e=>{var[r,i,n,a,t,o,s,c,v,m,l,d,y,x,p,u]=e,h=m*p*c-x*l*c+x*s*d-o*p*d-m*s*u+o*l*u,f=y*l*c-v*p*c-y*s*d+t*p*d+v*s*u-t*l*u,g=v*x*c-y*m*c+y*o*d-t*x*d-v*o*u+t*m*u,b=y*m*s-v*x*s-y*o*l+t*x*l+v*o*p-t*m*p,w=r*h+i*f+n*g+a*b;if(0===w)return e.fill(0);var z=1/w;return e.set([h*z,(x*l*a-m*p*a-x*n*d+i*p*d+m*n*u-i*l*u)*z,(o*p*a-x*s*a+x*n*c-i*p*c-o*n*u+i*s*u)*z,(m*s*a-o*l*a-m*n*c+i*l*c+o*n*d-i*s*d)*z,f*z,(v*p*a-y*l*a+y*n*d-r*p*d-v*n*u+r*l*u)*z,(y*s*a-t*p*a-y*n*c+r*p*c+t*n*u-r*s*u)*z,(t*l*a-v*s*a+v*n*c-r*l*c-t*n*d+r*s*d)*z,g*z,(y*m*a-v*x*a-y*i*d+r*x*d+v*i*u-r*m*u)*z,(t*x*a-y*o*a+y*i*c-r*x*c-t*i*u+r*o*u)*z,(v*o*a-t*m*a-v*i*c+r*m*c+t*i*d-r*o*d)*z,b*z,(v*x*n-y*m*n+y*i*l-r*x*l-v*i*p+r*m*p)*z,(y*o*n-t*x*n-y*i*s+r*x*s+t*i*p-r*o*p)*z,(t*m*n-v*o*n+v*i*s-r*m*s-t*i*l+r*o*l)*z]),e},q=(e,r,i)=>Math.min(Math.max(e,r),i),V=(e,r)=>e+Math.random()*(r-e),H=e=>e*(.5-Math.random()),G=(e=0,r=0,i=0,n=1)=>({x:e,y:r,z:i,w:n}),X=(e,r)=>(e.x=r.x,e.y=r.y,e.z=r.z,e.w=r.w,e),K=(e,r)=>{var{x:i,y:n,z:a}=r,t=Math.cos(i/2),o=Math.cos(n/2),s=Math.cos(a/2),c=Math.sin(i/2),v=Math.sin(n/2),m=Math.sin(a/2);return e.x=c*o*s+t*v*m,e.y=t*v*s-c*o*m,e.z=t*o*m+c*v*s,e.w=t*o*s-c*v*m,e},Z=(e,r,i)=>{var n=i/2,a=Math.sin(n);return e.x=r.x*a,e.y=r.y*a,e.z=r.z*a,e.w=Math.cos(n),e},Y=(e,r)=>{var i,n=r[0],a=r[4],t=r[8],o=r[1],s=r[5],c=r[9],v=r[2],m=r[6],l=r[10],d=n+s+l;return d>0?(i=.5/Math.sqrt(d+1),e.w=.25/i,e.x=(m-c)*i,e.y=(t-v)*i,e.z=(o-a)*i):n>s&&n>l?(i=2*Math.sqrt(1+n-s-l),e.w=(m-c)/i,e.x=.25*i,e.y=(a+o)/i,e.z=(t+v)/i):s>l?(i=2*Math.sqrt(1+s-n-l),e.w=(t-v)/i,e.x=(a+o)/i,e.y=.25*i,e.z=(c+m)/i):(i=2*Math.sqrt(1+l-n-s),e.w=(o-a)/i,e.x=(t+v)/i,e.y=(c+m)/i,e.z=.25*i),e},Q=(e,r,i)=>{var n=((e,r)=>2*Math.acos(Math.abs(q(J(e,r),-1,1))))(e,r);if(!n)return e;var a=Math.min(1,i/n);return re(e,r,a),e},J=(e,r)=>e.x*r.x+e.y*r.y+e.z*r.z+e.w*r.w,$=e=>{var r=(e=>Math.sqrt(e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w))(e);return r?(r=1/r,e.x=e.x*r,e.y=e.y*r,e.z=e.z*r,e.w=e.w*r):(e.x=0,e.y=0,e.z=0,e.w=1),e},ee=(e,r)=>{var i=e.x,n=e.y,a=e.z,t=e.w,o=r.x,s=r.y,c=r.z,v=r.w;return e.x=i*v+t*o+n*c-a*s,e.y=n*v+t*s+a*o-i*c,e.z=a*v+t*c+i*s-n*o,e.w=t*v-i*o-n*s-a*c,e},re=(e,r,i)=>{if(0===i)return e;if(1===i)return X(e,r);var{x:n,y:a,z:t,w:o}=e,s=o*r.w+n*r.x+a*r.y+t*r.z;if(s<0?(e.w=-r.w,e.x=-r.x,e.y=-r.y,e.z=-r.z,s=-s):X(e,r),s>=1)return e.w=o,e.x=n,e.y=a,e.z=t,e;var c=1-s*s;if(c<=Number.EPSILON){var v=1-i;return e.w=v*o+i*e.w,e.x=v*n+i*e.x,e.y=v*a+i*e.y,e.z=v*t+i*e.z,$(e)}var m=Math.sqrt(c),l=Math.atan2(m,s),d=Math.sin((1-i)*l)/m,y=Math.sin(i*l)/m;return e.w=o*d+e.w*y,e.x=n*d+e.x*y,e.y=a*d+e.y*y,e.z=t*d+e.z*y,e},ie=G(),ne=B(),ae=()=>({parent:void 0,children:[],components:[],position:m(),quaternion:G(),scale:m(1,1,1),matrix:B(),matrixWorld:B(),modelViewMatrix:B(),visible:!0,castShadow:!1,receiveShadow:!1}),te=(e,r)=>{Y(e.quaternion,k(ne,r,e.position,S))},oe=(e,r)=>(r.parent=e,e.children.push(r),e),se=(e,r)=>{var i=e.children.indexOf(r);i>=0&&e.children.splice(i,1)},ce=(e,r,i)=>(ee(e.quaternion,Z(ie,r,i)),e),ve=(e,r)=>{r(e),e.children.map((e=>ve(e,r)))},me=e=>{var r,i;(e=>{((e,r,i,n)=>{var{x:a,y:t,z:o,w:s}=i,c=a+a,v=t+t,m=o+o,l=a*c,d=a*v,y=a*m,x=t*v,p=t*m,u=o*m,h=s*c,f=s*v,g=s*m,b=n.x,w=n.y,z=n.z;e.set([(1-(x+u))*b,(d+g)*b,(y-f)*b,0,(d-g)*w,(1-(l+u))*w,(p+h)*w,0,(y+f)*z,(p-h)*z,(1-(l+x))*z,0,r.x,r.y,r.z,1])})(e.matrix,e.position,e.quaternion,e.scale)})(e),e.parent?U(e.matrixWorld,e.parent.matrixWorld,e.matrix):(r=e.matrixWorld,i=e.matrix,r.set(i)),e.children.map(me)},le=Math.PI/180,de=B(),ye=e=>{var{near:r,far:i}=e,n=r*Math.tan(.5*le*e.fov),a=-n,t=a*e.aspect,o=n*e.aspect,s=2*r/(o-t),c=2*r/(n-a),v=(o+t)/(o-t),m=(n+a)/(n-a),l=-(i+r)/(i-r),d=-2*i*r/(i-r);e.projectionMatrix.set([s,0,0,0,0,c,0,0,v,m,l,-1,0,0,d,0])},xe=G(),pe=G(),ue=(e=-1,r=1,i=1,n=-1,a=.1,t=2e3)=>{var o=c(s({},ae()),{left:e,right:r,top:i,bottom:n,near:a,far:t,up:y(S),matrixWorldInverse:B(),projectionMatrix:B()});return he(o),o},he=e=>{var{left:r,right:i,top:n,bottom:a,near:t,far:o}=e,s=1/(i-r),c=1/(n-a),v=1/(o-t),m=(i+r)*s,l=(n+a)*c,d=(o+t)*v;e.projectionMatrix.set([2*s,0,0,0,0,2*c,0,0,0,0,-2*v,0,-m,-l,-d,1])},fe=m(),ge=(e,r)=>{var{camera:i,matrix:n}=e;T(i.position,r.matrixWorld),((e,r)=>{Y(e.quaternion,k(de,e.position,r,e.up))})(i,T(fe,r.target.matrixWorld)),(e=>{me(e),e.matrixWorldInverse.set(e.matrixWorld),N(e.matrixWorldInverse)})(i),n.set([.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1]),U(n,U(n,n,i.projectionMatrix),i.matrixWorldInverse)},be=(e,r)=>s({parent:void 0,update:e},r),we=(e,r)=>(r.parent=e,e.components.push(r),e),ze=(e,...r)=>e.components.map((e=>e.update(...r))),Me=m(),Ee=m(),je=(e,r)=>{var i=F(e.position,r.position);return i<64?0:i<512?1:i<1024?2:3},Re=(e,r)=>{var i=je(e,r);return 3!==i&&!!(1!==i&&2!==i||((e,r)=>M(j(h(Ee,r.position,e.position)),w(Object.assign(Me,D),e.quaternion))>.3)(e,r))},Oe=new AudioContext,{sampleRate:Pe}=Oe,Fe=e=>2**((e-69)/12)*440,Ae=(e,r,i)=>{for(var n=r*Pe,a=new AudioBuffer({length:n,sampleRate:Pe}),t=a.getChannelData(0),o=0;o<n;o++)t[o]=e(o/Pe,o,t)*i;return a},Te=(e,r,i)=>new Proxy({},{get(n,a){var t=n[a]||Ae(e(Fe(a)),r,i);return n[a]=t,t}}),Ce=e=>r=>2*(r%(1/e)*e%1)-1,Se=e=>r=>r%(1/e)*e%1>.5?1:-1,De=()=>{var e=0;return()=>{var r=H(1),i=(e+.02*r)/1.02;return e=i,3.5*i}},_e=(e,r)=>i=>{var n=e(i),a=r(i);return(e,r,i)=>n(e,r,i)*a(e,r,i)},Le=(e,r,i)=>n=>(a,t,o)=>e(n+(a>i?r:0))(a,t,o),Ie=(e,r,i,n,a)=>{var t=e+r+i+n;return()=>i=>i<e?i/e:i<e+r?1-(i-e)/r*(1-a):i<t-n?a:i<t?(t-i)/n*a:0},We=new GainNode(Oe,{gain:.3}),Be=new GainNode(Oe,{gain:1-We.gain.value}),ke=new ConvolverNode(Oe),Ue=new GainNode(Oe);Ue.connect(Be).connect(Oe.destination),Ue.connect(ke).connect(We).connect(Oe.destination),(async()=>{var e=1.51,r=new OfflineAudioContext(1,e*Pe,Pe),i=new GainNode(r,{gain:0});i.gain.setValueAtTime(1,.01).exponentialRampToValueAtTime(.01,e);var n=new AudioBufferSourceNode(r,{buffer:Ae(De(),e,1)});n.connect(i).connect(r.destination),n.start(),ke.buffer=await r.startRendering()})();var Ne,qe=e=>((e,r=Oe.destination)=>{var i=new AudioBufferSourceNode(Oe,{buffer:e});i.connect(r),i.start()})(e,Ue),Ve=Te(_e(_e(Ce,De),(Ne=24,()=>e=>Math.exp(-e*Ne))),.5,1),He=Te(_e(_e(Se,Le(Se,Fe(36)-Fe(31),.1)),Ie(.003,.05,.01,.03,.5)),.3,.2),Ge=Te(_e(_e(Ce,Le(Se,Fe(27)-Fe(15),.1)),Ie(.001,.3,.4,.3,.7)),1,.4);addEventListener("click",(()=>Oe.resume()),{once:!0});var Xe,Ke,Ze=(...e)=>r=>e.reduce(((e,r)=>r(e)),r),Ye=e=>(...r)=>i=>e(i,...r),Qe=m(),Je=(e,r)=>(e.vertices.map((e=>w(e,r))),e),$e=(e,r,i,n)=>(l(Qe,r,i,n),e.vertices.map((e=>x(e,Qe))),e),er=Ye($e),rr=Ye(((e,r)=>{var i=e.vertices.length;return e.vertices.push(...r.vertices.map(y)),e.faces.push(...r.faces.map((e=>{var r=(e=>({a:e.a,b:e.b,c:e.c,color:y(e.color),vertexColors:e.vertexColors.map(y)}))(e);return r.a+=i,r.b+=i,r.c+=i,r}))),e})),ir=(e,r,i)=>{var n=e/2,a=r/2,t=i/2;return((e,r,i)=>{for(var n,a,t,o=e.vertices.length,s=0;s<r.length;)e.vertices.push(m(r[s++],r[s++],r[s++]));for(s=0;s<i.length;)e.faces.push((n=o+i[s++],a=o+i[s++],t=o+i[s++],{a:n,b:a,c:t,color:m(1,1,1),vertexColors:[]}));return e})({vertices:[],faces:[]},[n,a,t,n,a,-t,n,-a,t,n,-a,-t,-n,a,-t,-n,a,t,-n,-a,-t,-n,-a,t],[0,2,1,2,3,1,4,6,5,6,7,5,4,5,1,5,0,1,7,6,2,6,3,2,5,7,0,7,2,0,1,3,4,3,6,4])},nr=[0],ar=[1],tr=[2],or=[4],sr=[5],cr=[7],vr=[0,1],mr=[2,3],lr=[4,5],dr=[6,7],yr=[0,2],xr=[1,3],pr=[4,6],ur=[5,7],hr=[0,5],fr=[1,4],gr=[2,7],br=[0,1,2,3],wr=[4,5,6,7],zr=[0,1,4,5],Mr=[2,3,6,7],Er=[0,2,5,7],jr=[1,3,4,6],Rr=[0,1,2,3,4,5,6,7],Or=[0,1],Pr=[2,3],Fr=[4,5],Ar=[6,7],Tr=[8,9],Cr=[10,11],Sr=m(),Dr=m(),_r=m(),Lr=(e,r,i)=>{Array.isArray(r)?l(e,...r):"object"==typeof r?Object.assign(e,i,r):"number"==typeof r&&d(e,r)},Ir=(e,r,i)=>(d(i,0),r.map((r=>x(i,e.vertices[r]))),z(i,r.length),i),Wr=Ye(((e,r)=>(Ir(e,r,Sr),$e(e,-Sr.x,-Sr.y,-Sr.z)))),Br=Ye(((e,r,i,n)=>(Ir(e,r,Dr),Ir(i,n,_r),h(Sr,Dr,_r),$e(e,-Sr.x,-Sr.y,-Sr.z)))),kr=(e,r=m())=>(i,...n)=>(n.map((([n,a])=>{Lr(Sr,a,r),n.map((r=>e(i.vertices[r],Sr)))})),i),Ur=Ye(kr(x)),Nr=Ye(kr(f,m(1,1,1))),qr=((e,r=m())=>i=>(n,...a)=>(a.map((([a,t=r[i]])=>{Object.assign(Sr,r),Sr[i]=t,a.map((r=>e(n.vertices[r],Sr)))})),n))(x),Vr=Ye(qr("x")),Hr=Ye(qr("z")),Gr=(Xe=m(),Ke=new Map([[br,wr],[zr,Mr],[Er,jr],[wr,br],[Mr,zr],[jr,Er]]),(e,r,i)=>{Lr(Sr,i,Xe);var n=Ke.get(r),a=ir();return r.map(((r,i)=>{var t=n[i];Object.assign(a.vertices[n===br||n===wr?1^t:t],e.vertices[r]),x(Object.assign(a.vertices[r],e.vertices[r]),Sr)})),a}),Xr=Ye(((e,...r)=>(r.flat().sort(((e,r)=>e-r)).reverse().map((r=>e.faces.splice(r,1))),e))),Kr=m(0,-800,0),Zr=new WeakMap,Yr=(e,r,i)=>{var n=Zr.get(e)||{};return Zr.set(e,n),n[r]=n[r]||[],n[r].push(i),e},Qr=(e,r,i)=>{var n,a;return null==(a=null==(n=Zr.get(e))?void 0:n[r])||a.map((e=>e(i))),e},Jr=e=>{var r=0,i=e;return(n,a=!0)=>{if((i+=n)-r>e)return a&&(r=i),a}},$r=()=>({color:m(1,1,1),specular:m(1/15,1/15,1/15),shininess:30,emissive:m(),fog:!0}),ei=(e,r)=>c(s({},ae()),{geometry:e,material:r}),ri=m(),ii=(e=m(1/0,1/0,1/0),r=m(-1/0,-1/0,-1/0))=>({min:e,max:r}),ni=(e,r)=>(Object.assign(e.min,r.min),Object.assign(e.max,r.max),e),ai=e=>e.max.x<e.min.x||e.max.y<e.min.y||e.max.z<e.min.z,ti=(e,r)=>{var i,n;return i=e.min,n=r,i.x=Math.min(i.x,n.x),i.y=Math.min(i.y,n.y),i.z=Math.min(i.z,n.z),((e,r)=>{e.x=Math.max(e.x,r.x),e.y=Math.max(e.y,r.y),e.z=Math.max(e.z,r.z)})(e.max,r),e},oi=(e,r)=>((e=>{e.min.x=e.min.y=e.min.z=1/0,e.max.x=e.max.y=e.max.z-=1/0})(e),((e,r)=>{me(r),ve(r,(r=>{var i;return null==(i=r.geometry)?void 0:i.vertices.map((i=>ti(e,b(Object.assign(ri,i),r.matrixWorld))))}))})(e,r),e),si=(e,r)=>e.min.x<=r.x&&r.x<=e.max.x&&e.min.y<=r.y&&r.y<=e.max.y&&e.min.z<=r.z&&r.z<=e.max.z,ci=(e,r)=>!(e.max.x<=r.min.x||e.min.x>=r.max.x||e.max.y<=r.min.y||e.min.y>=r.max.y||e.max.z<=r.min.z||e.min.z>=r.max.z),vi=(e,r)=>(x(e.min,r),x(e.max,r),e),mi=Ye(((e,...r)=>(r.map((([r,i])=>{var n=m();Lr(n,i),e.faces.map((e=>r.map((r=>((e,r,i)=>{e.a===r&&(e.vertexColors[0]=i),e.b===r&&(e.vertexColors[1]=i),e.c===r&&(e.vertexColors[2]=i)})(e,r,n)))))})),e))),li=Ye(((e,...r)=>(r.map((([r,i])=>r.map((r=>Lr(e.faces[r].color,i))))),e))),di=G(),yi=m(),xi=(e,...r)=>Ze(...r)(ir(...e)),pi=(...e)=>Ze(...e.map(rr))({vertices:[],faces:[]}),ui=ir(1,1,1),hi=$r();d(hi.emissive,1);var fi=$r();d(fi.color,0);var gi,bi,wi,zi,Mi,Ei,ji,Ri,Oi,Pi,Fi,Ai,Ti,Ci,Si,Di,_i,Li,Ii,Wi,Bi,ki,Ui,Ni=(e,r)=>{var i,n,a,t,o,s=ae(),c=(i=e,n=m(),ai(i)?d(n,0):g((a=n,t=i.min,o=i.max,a.x=t.x+o.x,a.y=t.y+o.y,a.z=t.z+o.z,a),.5)),v=((e,r)=>ai(e)?d(r,0):h(r,e.max,e.min))(e,m()),y=[...Array(r)].map((()=>{var e=ei(ui,hi);e.castShadow=!0,l(e.scale,V(4,v.x),V(4,2*v.y),V(4,v.z)),l(e.position,H(.5),H(.5),H(.5));var r=ei(ui,fi);return l(r.scale,1-2/e.scale.x,1-2/e.scale.y,1-2/e.scale.z),e.scale.x*=-1,oe(e,r),x(f(e.position,v),c),oe(s,e),m(0,V(32,256),0)}));return we(s,be((e=>{var r=0;s.children.map(((i,n)=>{p(i.position,y[n],e),g(i.scale,1-5*e),E(i.scale)>.01&&r++})),r||se(s.parent,s)})))},qi=xi([.5,.5,1]),Vi=[[1,1,1],[1,.75,0],[1,.5,0]].map((e=>{var r=$r();return l(r.color,...e),l(r.emissive,...e),r})),Hi=e=>{var r=ae(),i=[...Array(e)].map((()=>{var e,i=ei(qi,(e=Vi)[Math.random()*e.length|0]);i.castShadow=!0,d(i.scale,V(1,8)),l(i.position,H(4),H(4),H(4)),oe(r,i);var n=R(y(i.position),V(64,128));return te(i,n),n}));return we(r,be((e=>{var n=0;r.children.map(((r,a)=>{p(r.position,p(i[a],Kr,e),e),g(r.scale,1-8*e),E(r.scale)>.01&&n++})),n||se(r.parent,r)})))},Gi=(gi=m(),bi=m(),wi=B(),zi=m(),(e,r,i)=>{var n=0,a=e.faces.map((r=>{var i,a,t;return n+=(i=e.vertices[r.a],a=e.vertices[r.b],t=e.vertices[r.c],.5*E(O(h(gi,t,a),h(bi,i,a))))}));return pi(...[...Array(r)].map((()=>{var r,t,o,s,c=(e=>{for(var r=0,i=a.length-1;r<=i;){var n=Math.ceil((r+i)/2);if(!n||a[n-1]<=e&&a[n]>e)return n;e<a[n]?i=n-1:r=n+1}return-1})(Math.random()*n),v=e.faces[c],m=e.vertices[v.a],l=e.vertices[v.b],y=e.vertices[v.c],x=((e,r,i)=>{var n=Math.random(),a=Math.random();n+a>1&&(n=1-n,a=1-a);var t=1-n-a;return p(p(p(d(yi,0),e,n),r,a),i,t)})(m,l,y),u=(r=m,j(O(h(gi,y,t=l),h(bi,r,t))));o=k(wi,zi,u,S),s=x,o[12]=s.x,o[13]=s.y,o[14]=s.z;var f=i();return f.vertices.map((e=>b(e,wi))),f})))}),Xi=(e,r)=>we(e,((e,r)=>{var i={physics:r,boundingBox:oi(ii(),e),velocity:m(),collide(){}};return be((r=>p(e.position,i.velocity,r)),i)})(e,r)),Ki=e=>((e,r)=>e.components.find(r))(e,Zi),Zi=e=>e.physics,Yi=e=>{var r=[];return ve(e,(e=>{var i,n;r.push(...(i=e,n=Zi,i.components.filter(n)))})),r},Qi=(Mi=m(),(e,r,i,n)=>{var a=n.max.x-i.min.x,t=i.max.x-n.min.x,o=n.max.y-i.min.y,s=i.max.y-n.min.y,c=n.max.z-i.min.z,v=i.max.z-n.min.z,m=0;a>0&&t>0&&(m=a<t?a:-t);var d=0;o>0&&s>0&&(d=o<s?o:-s);var y=0;c>0&&v>0&&(y=c<v?c:-v);var h=Math.abs(m),f=Math.abs(d),b=Math.abs(y);h<f&&h<b?l(Mi,m,0,0):f<b?l(Mi,0,d,0):l(Mi,0,0,y);var w=e.parent,z=r.parent;1===e.physics?(p(z.position,Mi,-1.001),_(r.velocity,j(Mi),1.001)):1===r.physics?(p(w.position,Mi,1.001),_(e.velocity,j(Mi),1.001)):(g(Mi,.5),E(Mi)<1.001&&R(Mi,1.001),x(w.position,Mi),u(z.position,Mi))}),Ji=(Ei=m(),ji=m(),(e,r,i,n,a)=>{if(ci(n,a))return e.allsolid=!0,void(e.fraction=0);d(Ei,1/0),h(ji,i.velocity,r.velocity);var t=ji.x,o=ji.y,s=ji.z,c=a.max.x-n.min.x,v=n.max.x-a.min.x,m=a.max.y-n.min.y,y=n.max.y-a.min.y,x=a.max.z-n.min.z,p=n.max.z-a.min.z,u=0,f=1/0;if(t<0){if(c<0)return;c>0&&(f=Math.min(-c/t,f)),v<0&&(Ei.x=v/t,u=Math.max(Ei.x,u))}else if(t>0){if(v<0)return;v>0&&(f=Math.min(v/t,f)),c<0&&(Ei.x=-c/t,u=Math.max(Ei.x,u))}if(!(u>f)){if(o<0){if(m<0)return;m>0&&(f=Math.min(-m/o,f)),y<0&&(Ei.y=y/o,u=Math.max(Ei.y,u))}else if(o>0){if(y<0)return;y>0&&(f=Math.min(y/o,f)),m<0&&(Ei.y=-m/o,u=Math.max(Ei.y,u))}if(!(u>f)){if(s<0){if(x<0)return;x>0&&(f=Math.min(-x/s,f)),p<0&&(Ei.z=p/s,u=Math.max(Ei.z,u))}else if(s>0){if(p<0)return;p>0&&(f=Math.min(p/s,f)),x<0&&(Ei.z=-x/s,u=Math.max(Ei.z,u))}u>f||(e.fraction=u,Ei.x<Ei.y&&Ei.x<Ei.z?l(e.normal,Math.sign(t),0,0):Ei.y<Ei.z?l(e.normal,0,Math.sign(o),0):l(e.normal,0,0,Math.sign(s)))}}}),$i=(e,r)=>vi(ni(e,r.boundingBox),r.parent.position),en=(Ri=ii(),Oi=ii(),Pi=ii(),e=>{for(var r=0;r<e.length;r++)for(var i=e[r],n=r+1;n<e.length;n++){var a,t,o=e[n];if((1!==i.physics||1!==o.physics)&&(4!==i.physics||4!==o.physics)&&(4!==i.physics&&4!==o.physics||(4===i.physics?(a=i,t=o):(a=o,t=i),!si($i(Ri,t),a.parent.position)||!1!==a.collide(t.parent)))&&ci($i(Oi,i),$i(Pi,o))){if(!1===i.collide(o.parent)||!1===o.collide(i.parent))continue;Qr(i.parent,"collide",o.parent),Qr(o.parent,"collide",i.parent),Qi(i,o,Oi,Pi)}}}),rn=y(S),nn=()=>({allsolid:!1,fraction:1,endpos:m(),normal:m()}),an=(e,r)=>(e.allsolid=r.allsolid,e.fraction=r.fraction,Object.assign(e.endpos,r.endpos),Object.assign(e.normal,r.normal),e),tn=(Fi=nn(),e=>(an(e,Fi),e)),on=(()=>{var e=ii(),r=ii(),i=ii(),n=m(),a=m(),t=nn();return(o,s,c,v,m)=>{var l,d;tn(c),Object.assign(n,s.velocity),Object.assign(s.velocity,h(a,m,v)),l=vi(ni(i,s.boundingBox),m),d=vi(ni(e,s.boundingBox),v),ti(ti(l,d.min),d.max);for(var y=0;y<o.length;y++){var p=o[y];ci(i,vi(ni(r,p.boundingBox),p.parent.position))&&(Ji(tn(t),s,p,e,r),t.fraction<c.fraction&&an(c,t))}Object.assign(s.velocity,n),((e,r,i,n)=>{x(g(h(e,i,r),n),r)})(c.endpos,v,m,c.fraction)}})(),sn=(e,r,i,n)=>{var a=Yi(e.scene).filter((r=>r!==e.body&&4!==r.physics));on(a,e.body,r,i,n)},cn=(Ti=m(),Ci=[...Array(5)].map((()=>m())),Si=m(),Di=nn(),_i=m(),Li=m(),Ii=m(),(e,r)=>{r&&(Object.assign(Li,e.body.velocity),Li.y-=e.gravity*e.dt,e.body.velocity.y=.5*(e.body.velocity.y+Li.y),e.walking&&_(e.body.velocity,rn,1.001));var i,n=e.dt;for(e.walking?(Ai=1,Object.assign(Ci[0],rn)):Ai=0,j(Object.assign(Ci[Ai],e.body.velocity)),Ai++,i=0;i<4;i++){if(p(Object.assign(_i,e.object.position),e.body.velocity,n),sn(e,Di,e.object.position,_i),Di.allsolid)return e.body.velocity.y=0,!0;if(Di.fraction>0&&Object.assign(e.object.position,Di.endpos),1===Di.fraction)break;if(n-=n*Di.fraction,Ai>=5)return d(e.body.velocity,0),!0;for(var a=0;a<Ai;a++)if(M(Di.normal,Ci[a])>.99){x(e.body.velocity,Di.normal);break}if(!(a<Ai))for(Object.assign(Ci[Ai],Di.normal),Ai++,a=0;a<Ai;a++)if(!(M(e.body.velocity,Ci[a])>=.1)){_(Object.assign(Si,e.body.velocity),Ci[a],1.001),r&&_(Object.assign(Ii,Li),Ci[a],1.001);for(var t=0;t<Ai;t++)if(t!==a&&!(M(Si,Ci[t])>=.1||(_(Si,Ci[t],1.001),r&&_(Ii,Ci[t],1.001),M(Si,Ci[a])>=0))){g(Object.assign(Si,j(P(Ti,Ci[a],Ci[t]))),M(Ti,e.body.velocity)),r&&g(Object.assign(Ii,Ti),M(Ti,Li));for(var o=0;o<Ai;o++)if(o!==a&&o!==t&&!(M(Si,Ci[o])>=.1))return d(e.body.velocity,0),!0}Object.assign(e.body.velocity,Si),r&&Object.assign(Li,Ii);break}}return r&&Object.assign(e.body.velocity,Li),0!==i}),vn=e=>!(e.command.y<10)&&(e.jump?(e.command.y=0,!1):(e.walking=!1,e.jump=!0,e.body.velocity.y=270,qe(He[31]),!0)),mn=(Wi=m(),Bi=m(),e=>{if(vn(e))ln(e);else{dn(e);var r=e.command.z,i=e.command.x,n=yn(e);e.viewForward.y=0,e.viewRight.y=0,p(p(d(Wi,0),j(_(e.viewForward,rn,1.001)),r),j(_(e.viewRight,rn,1.001)),i);var a=E(Object.assign(Bi,Wi));j(Bi),xn(e,Bi,a*=n,10),_(e.body.velocity,rn,1.001),(e.body.velocity.x||e.body.velocity.z)&&cn(e,!1)}}),ln=(()=>{var e=m(),r=m();return i=>{dn(i);var n=i.command.z,a=i.command.x,t=yn(i);i.viewForward.y=0,i.viewRight.y=0,p(p(d(e,0),j(i.viewForward),n),j(i.viewRight),a),e.y=0,Object.assign(r,e);var o=E(r);j(r),xn(i,r,o*=t,1),i.walking&&_(i.body.velocity,rn,1.001),cn(i,!0)}})(),dn=(ki=m(),e=>{var r=e.body.velocity;Object.assign(ki,r),e.walking&&(ki.y=0);var i=E(ki);if(i<1)return r.x=0,void(r.z=0);var n=0;e.walking&&(n+=6*(i<100?100:i)*e.dt);var a=i-n;a<0&&(a=0),g(r,a/=i)}),yn=e=>{var r=Math.max(Math.abs(e.command.x),Math.abs(e.command.y),Math.abs(e.command.z));if(!r)return 0;var i=E(e.command);return e.speed*r/(127*i)},xn=(e,r,i,n)=>{var a=i-M(e.body.velocity,r);if(!(a<=0)){var t=n*e.dt*i;t>a&&(t=a),p(e.body.velocity,r,t)}},pn=(()=>{var e=m(),r=nn();return i=>{Object.assign(e,i.object.position),e.y-=.25,sn(i,r,i.object.position,e),1!==r.fraction?i.walking=!0:i.walking=!1}})(),un=(Ui={},addEventListener("keydown",(e=>Ui[e.code]=!0)),addEventListener("keyup",(e=>Ui[e.code]=!1)),Ui),hn=!1,fn=G(),gn=m(),bn=m(),wn=(e,r,i)=>{var n=e.createProgram(),a=(r,i)=>{var a=e.createShader(r);e.shaderSource(a,i),e.compileShader(a),e.attachShader(n,a)};return a(e.VERTEX_SHADER,r),a(e.FRAGMENT_SHADER,i),e.linkProgram(n),n},zn=(e,r,i)=>e.uniformMatrix4fv(r,!1,i),Mn=(e,r,i)=>e.uniform3f(r,i.x,i.y,i.z),En=(e,r)=>{for(var i={},n=e.getProgramParameter(r,e.ACTIVE_ATTRIBUTES),a=0;a<n;a++){var t=e.getActiveAttrib(r,a),{name:o}=t;i[o]=e.getAttribLocation(r,o)}return i},jn=(e,r)=>{for(var i={},n=e.getProgramParameter(r,e.ACTIVE_UNIFORMS),a=0;a<n;a++){var t=e.getActiveUniform(r,a),{name:o}=t;i[o]=e.getUniformLocation(r,o)}return i},Rn="\n#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nvec4 packDepthToRGBA(float v) {\n  vec4 r = vec4(\n    fract(\n      v *\n      // PackFactors\n      vec3(256 * 256 * 256, 256 * 256, 256)\n    ),\n    v\n  );\n  r.yzw -=\n    r.xyz *\n    // ShiftRight8\n    1. / 256.;\n  return\n    r *\n    // PackUpscale\n    256. / 255.;\n}\n\nin vec2 vHighPrecisionZW;\n\nout vec4 color;\n\nvoid main() {\n  color = packDepthToRGBA(\n    // fragCoordZ\n    .5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + .5\n  );\n}\n".trim(),On="\n#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nin vec3 position;\n\nout vec2 vHighPrecisionZW;\n\nvoid main() {\n  gl_Position =\n    projectionMatrix *\n    // mvPosition\n    modelViewMatrix * vec4(position, 1);\n  vHighPrecisionZW = gl_Position.zw;\n}\n".trim(),Pn="\n#version 300 es\n\nprecision highp float;\nprecision highp int;\n\n#define saturate(a) clamp(a, 0., 1.)\n\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\n\nin vec3 vColor;\n\nuniform bool fog;\nuniform vec3 fogColor;\nin vec3 vFogPosition;\nuniform float fogNear;\nuniform float fogFar;\n\nuniform bool receiveShadow;\nuniform vec3 ambient;\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 color;\n};\n\nuniform DirectionalLight directionalLight;\n\nin vec3 vViewPosition;\n\nuniform sampler2D directionalShadowMap;\nin vec4 vDirectionalShadowCoord;\n\nout vec4 color;\n\nvoid main() {\n  vec3 diffuseColor = diffuse * vColor;\n\n  vec3 normal = normalize(cross(dFdx(vViewPosition), dFdy(vViewPosition)));\n  vec3 viewDir = normalize(vViewPosition);\n\n  vec4 shadowCoord = vDirectionalShadowCoord;\n  shadowCoord.xyz /= shadowCoord.w;\n  vec3 irradiance =\n    // dotNL\n    saturate(dot(normal, directionalLight.direction)) *\n    directionalLight.color *\n    // getShadow\n    (receiveShadow &&\n    all(\n      bvec2(\n        all(\n          bvec4(\n            shadowCoord.x >= 0.,\n            shadowCoord.x <= 1.,\n            shadowCoord.y >= 0.,\n            shadowCoord.y <= 1.\n          )\n        ),\n        shadowCoord.z <= 1.\n      )\n    )\n      ? // texture2DCompare\n        step(\n          shadowCoord.z,\n          // unpackRGBAToDepth\n          dot(\n            texture(directionalShadowMap, shadowCoord.xy),\n            // UnpackFactors\n            // UnpackDownscale\n            255. / 256. /\n            // PackFactors\n            vec4(256 * 256 * 256, 256 * 256, 256, 1.)\n          )\n        )\n      : 1.);\n  vec3 halfDir = normalize(directionalLight.direction + viewDir);\n  float dotVH = saturate(dot(viewDir, halfDir));\n  float fresnel = exp2((-5.55473 * dotVH - 6.98316) * dotVH);\n\n  color = vec4(\n    mix(\n      // outgoingLight\n      // directDiffuse\n      irradiance * diffuseColor +\n      // indirectDiffuse\n      ambient * diffuseColor +\n      // directSpecular\n      irradiance *\n        // F_Schlick\n        (specular * (1. - fresnel) + fresnel) *\n        // G_BlinnPhong_Implicit\n        .25 *\n        // D_BlinnPhong\n        (shininess * .5 + 1.) *\n        pow(\n          // dotNH\n          saturate(dot(normal, halfDir)),\n          shininess\n       ) +\n      emissive,\n      fogColor,\n      // fogFactor\n      fog\n        ? smoothstep(\n            fogNear,\n            fogFar,\n            // fogDepth\n            length(vFogPosition)\n          )\n        : 0.\n    ),\n    1\n  );\n}\n".trim(),Fn="\n#version 300 es\n\nprecision highp float;\nprecision highp int;\n\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nin vec3 position;\nout vec3 vViewPosition;\n\nin vec3 color;\nout vec3 vColor;\n\nout vec3 vFogPosition;\n\nuniform mat4 directionalShadowMatrix;\nout vec4 vDirectionalShadowCoord;\n\nvoid main() {\n  vColor.xyz = color.xyz;\n\n  vec4 mvPosition = modelViewMatrix * vec4(position, 1);\n\n  gl_Position = projectionMatrix * mvPosition;\n  vViewPosition = -mvPosition.xyz;\n\n  vDirectionalShadowCoord =\n    directionalShadowMatrix *\n    // worldPosition\n    modelMatrix * vec4(position, 1);\n\n  vFogPosition = mvPosition.xyz;\n}\n".trim(),An=canvas.getContext("webgl2");An.clearColor(0,0,0,0),An.enable(An.DEPTH_TEST),An.enable(An.CULL_FACE),An.depthFunc(An.LEQUAL);var Tn=!1,Cn=ae();Cn.fogColor=m(),Cn.fogNear=1,Cn.fogFar=1e3;var Sn,Dn,_n,Ln,In=((e=60,r=1,i=.1,n=2e3)=>{var a=c(s({},ae()),{fov:e,near:i,far:n,aspect:r,up:y(S),matrixWorldInverse:B(),projectionMatrix:B()});return ye(a),a})(90);((e,r)=>{document.addEventListener("pointerlockchange",(()=>e.enabled=r===document.pointerLockElement)),addEventListener("click",(()=>r.requestPointerLock()))})((Sn=In,Dn=m(),_n=m(),Ln={object:Sn,sensitivity:.002,enabled:!1,onMouseMove(e){Ln.enabled&&(Dn.x=q(Dn.x-e.movementY*Ln.sensitivity,-Math.PI/2,Math.PI/2),_n.y-=e.movementX*Ln.sensitivity,Object.assign(Sn.quaternion,ee(K(pe,_n),K(xe,Dn))))}},addEventListener("mousemove",Ln.onMouseMove),Ln),canvas);var{ambient:Wn,directional:Bn}=((e,r,i)=>{var n=ae();oe(r,n);var a=m(.2,.2,.3),t=((e=m(),r=1)=>c(s({},ae()),{color:e,intensity:r,target:ae(),shadow:{camera:ue(-5,5,5,-5,.5,500),matrix:B()}}))(m(1,1,1));l(t.position,64,256,-64),oe(n,t),i.far=16384;var o=ae();oe(o,i),oe(n,o);var v=Xi(ei(ir(30,56,30),$r()),2);v.position.y+=28,v.visible=!1,Object.assign(o.position,v.position),oe(n,v);var y=Ki(v);y.update=()=>{};var u={object:v,body:y,scene:void 0,command:m(),dt:0,gravity:800,speed:320,viewForward:m(),viewRight:m(),jump:0,walking:!1};u.scene=n;var f=100,z=0,P=()=>{var e=512,r=b(Object.assign(gn,o.position),t.shadow.camera.matrixWorldInverse);Object.assign(t.shadow.camera,{left:r.x-e,right:r.x+e,top:r.y+e,bottom:r.y-e}),he(t.shadow.camera)};me(t),ge(t.shadow,t),P();var A=e=>{var r=$r();l(r.color,.7,.7,.75);var i=Xi(ei(e,r),1);return i.castShadow=!0,i.receiveShadow=!0,oe(n,i),i};[[[160,128,256],[-512,0,128],[Wr(dr)]]].map((([e,r,i=[Wr(Mr)]])=>l(A(xi(e,...i)).position,...r))),[[[1024,16,768,8],[0,0,0]],[[128,8,256,8],[256,48,-240]],[[128,8,172,8],[-256,16,-192]],[[160,8,246,8],[128,160,0]],[[512,8,352,8],[0,32,-544]],[[128,8,128,8],[256,64,0]],[[128,8,160,8],[320,96,144]],[[480,8,128,8],[0,128,256]],[[128,24,128,8],[-160,12,0]],[[128,24,128,8],[-160,96,0]]].map((([e,r])=>l(A(((e,r,i,n)=>{var a=e-4*n,t=i-4*n,o=Xr(Or,Pr,Tr,Cr),s=xi([e-2*n,r,t],o),c=xi([a,r,n],Br(jr,s,Er),Vr([pr,-n],[xr,n]),o),v=xi([a,r,n],Br(Er,s,jr),Vr([ur,-n],[yr,n]),o),m=[n,r,n],l=mi([Rr,[.4,.4,.5]]),d=n/2;return pi(s,c,v,xi([a,r,n],Br(jr,c,Er),Vr([ur,-d],[yr,d]),Xr(Or,Pr,Cr),l),xi([a,r,n],Br(Er,v,jr),Vr([pr,-d],[xr,d]),Xr(Or,Pr,Tr),l),xi([n,r,t],Br(wr,s,br),Hr([xr,-d],[yr,d]),Xr(Pr,Tr,Cr),l),xi([n,r,t],Br(br,s,wr),Hr([pr,-d],[ur,d]),Xr(Or,Tr,Cr),l),xi(m,Br(pr,s,yr),Ur([br,{z:d}],[Er,{x:-n}],[yr,{x:-d,z:d}]),l),xi(m,Br(xr,s,ur),Ur([wr,{z:d}],[Er,{x:n}],[ur,{x:d,z:d}]),l),xi(m,Br(ur,s,xr),Ur([br,{z:-d}],[jr,{x:-n}],[xr,{x:-d,z:-d}]),l),xi(m,Br(yr,s,pr),Ur([wr,{z:-d}],[jr,{x:n}],[pr,{x:d,z:-d}]),l))})(...e)).position,...r))),[].map((([e,r,i,n])=>A(((e,r,i,n)=>{h(yi,r,e);var a=yi.x,t=yi.z;return xi(a?[a,n,i]:[i,n,t],Wr(a?lr:fr),er(e.x,e.y,e.z))})(m(...e),m(...r),i,n)))),((e,r,i)=>{var n=(r-e)/(i+1);return[...Array(i)].map(((r,i)=>e+n*(i+1)))})(256,0,4).map((e=>[-340,0,e])).map((e=>l(A(((e,r,i=e)=>{var n=xi([i,3/16*r,e],Wr(Mr)),a=Ze((()=>Gr(n,zr,{y:3/4*r})),Vr([vr,-i/2]),Xr(Ar))(),t=Ze((()=>Gr(a,zr,{y:1/16*r})),Vr([vr,-i/2]),Xr(Ar))();return pi(n,a,t)})(24,128)).position,...e)));var T=$r();d(T.emissive,1),T.fog=!1,oe(o,ei(((e,r)=>{for(var i=[],n=0;n<r;n++){var a=2*Math.PI*Math.random(),t=2*Math.random()-1,o=Math.sqrt(1-t*t),s=V(8,32);i.push(xi([s,s,s],er(e*o*Math.cos(a),e*o*Math.sin(a),e*t)))}return pi(...i)})(15360,512),T));var _=$r();d(_.specular,1),_.fog=!1;var L,I,W,k,U,N,G,X,Y,J,$,ee,re,ie,ne=ei((k=512,U=5/6*(I=1280),N=xi([I,W=128,L=12288],Wr(br),Vr([ur,U],[Rr,-256]),Ur([gr,{y:W}]),Xr(Fr)),G=Ze((()=>Gr(N,zr,{y:k})),Ur([pr,{x:U}],[hr,{y:-512}]),Xr(Pr,Ar))(),X=Ze((()=>Gr(G,wr,{x:-U})),Ur([ur,{x:U}],[or,{y:-512}]),Xr(Or,Ar))(),Y=xi([I,W,L],Wr(wr),Vr([yr,-U],[Rr,256]),Ur([gr,{y:W}]),Xr(Fr)),J=Ze((()=>Gr(Y,zr,{y:k})),Ur([xr,{x:-U}],[hr,{y:-512}]),Xr(Or,Ar))(),$=Ze((()=>Gr(J,br,{x:U})),Ur([yr,{x:-U}],[ar,{y:-512}]),Xr(Pr,Ar))(),ee=pi(N,G,X,Y,J,$,xi([768,384,3072],Wr(gr),Ur([Rr,{z:-4096}],[fr,{y:-128}]))),pi(ee,Gi(ee,2048,(()=>xi([V(16,128),V(16,128),V(16,64)],Wr(Er)))))),_);l(ne.position,512,1536,-6144),re=ne,ie=-Math.PI/2,ce(re,S,ie),((e,r)=>{ce(e,C,r)})(ne,-Math.PI/8),((e,r)=>{ce(e,D,r)})(ne,-Math.PI/4),oe(n,ne);var ve,le,de=()=>{var e,r,i,n,a,t,o,s=$r(),c=ei((e=40,r=16,i=m(16,1,1),n=xi([e,12,r],Wr(Mr),Ur([Rr,{y:60}],[vr,{x:-20}],[lr,{x:20}],[hr,{z:-16}],[tr,{x:-20}],[cr,{x:20}],[gr,{y:-8}])),a=xi([18,56,r],Wr(mr),Ur([Rr,{x:-2}],[dr,{x:18}],[vr,{y:-8}],[gr,{z:-16}],[sr,{z:-16}])),t=xi([18,56,r],Wr(dr),Ur([Rr,{x:2}],[mr,{x:-18}],[lr,{y:-8}],[gr,{z:-16}],[nr,{z:-16}])),o=xi([8,8,8],(e=>Je(e,K(di,l(yi,Math.PI/4,-Math.PI/4,0)))),li([Or,i],[Fr,i],[Tr,i]),er(0,54,-4)),pi(n,a,t,o)),s);return d(s.color,.5),d(s.specular,1),c.castShadow=!0,c.receiveShadow=!0,c},ye=(e,r)=>{var i,a=r,t=Ki(e);return Yr(e,"collide",(r=>{if(4===Ki(r).physics)if(a--,clearTimeout(i),a<=0){qe(Ge[15]),Me(e.position);var o=Ni(t.boundingBox,16);Object.assign(o.position,e.position),Object.assign(o.quaternion,e.quaternion),oe(n,o),se(n,e)}else e.material.emissive.x=1,i=setTimeout((()=>e.material.emissive.x=0),48)})),e},xe=(e,r)=>{var i=0;return we(e,be((n=>{(i+=n)>r&&se(e.parent,e)})))},pe=()=>{var e=$r();d(e.color,.5),d(e.specular,1);var r,i,n=ei((r=m(16,1,1),i=xi([16,16,6],Nr([Er,{x:.5,y:.5}]),li([Tr,r]),Xr(Cr)),Je(pi(i,xi([16,16,26],Br(Er,i,jr),Nr([jr,{x:0,y:0}]),Xr(Tr))),K(di,l(yi,0,0,Math.PI/4)))),e);return n.castShadow=!0,n.receiveShadow=!0,n},fe=()=>{var e=ir(2,2,8),r=$r();l(r.emissive,2,.5,.5);var i=xe(Xi(ei(e,r),4));return i.castShadow=!0,i},ze=(e=2)=>{(f-=e)<=0&&(document.exitPointerLock(),document.querySelector(".e").hidden=!1)},Me=e=>{var r=Hi(4);Object.assign(r.position,e),oe(n,r)},Ee=Jr(.1),Oe=Jr(7),Pe=Jr(3);return we(n,be((e=>{ve=Yi(n),(le=ve.filter((e=>1===e.physics))).map((e=>e.parent)),en(ve),u.dt=e,d(u.command,0),(un.KeyW||un.ArrowUp)&&u.command.z++,(un.KeyS||un.ArrowDown)&&u.command.z--,(un.KeyA||un.ArrowLeft)&&u.command.x--,(un.KeyD||un.ArrowRight)&&u.command.x++,un.Space&&u.command.y++;if(g(u.command,127),l(u.viewForward,0,0,-1),l(u.viewRight,1,0,0),w(l(u.viewForward,0,0,-1),i.quaternion),j(O(l(u.viewRight,0,-1,0),u.viewForward)),(e=>{e.command.y<10&&(e.jump=!1),pn(e),e.walking?mn(e):ln(e),pn(e)})(u),Object.assign(o.position,v.position),P(),f=q(f+1*e,0,100),document.querySelector(".h").textContent=Math.round(f),document.querySelector(".s").textContent=z,v.position.y<=-2048&&ze(100),Ee(e,hn)){qe(Ve[16]);var r=ir(2,2,8),a=$r();l(a.emissive,.5,.5,2);var t=xe(Xi(ei(r,a),4),4);t.castShadow=!0,te(t,p(l(gn,H(1),H(1),H(1)),w(Object.assign(bn,D),i.quaternion),-16));var s=Ki(t);p(s.velocity,w(Object.assign(gn,D),t.quaternion),800),x(w(l(t.position,7.5,-7,0),i.quaternion),v.position),oe(n,t),s.collide=e=>{if(e===v)return!1;Me(t.position),se(n,t),e.isPhantom&&(z+=100),e.isScanner&&(z+=50)}}if(Oe(e)){var c=(()=>{var e=0,r=m(),i=m(),a=nn(),t=Jr(1.1),o=we(ye(Xi(de(),2),5),be((s=>{0===e&&Re(o,v);var c=Ki(o);p(c.velocity,Kr,s);var m=je(o,v),l=2===e||Re(o,v)?h(gn,v.position,o.position):d(gn,0);if(l.y=0,j(l),E(l)&&(Z(fn,S,Math.atan2(l.x,l.z)),Q(o.quaternion,fn,Math.PI*s),R(Object.assign(bn,l),160),Object.assign(r,o.position),p(Object.assign(i,r),bn,16*s),Object.assign(r,i),i.y-=.25,on(le,c,a,r,i),a.allsolid),0!==m){var y=c.velocity.y;c.velocity.y=0;var x=E(c.velocity),u=Math.max(x,100),f=Math.max(x-6*u*s,0);R(c.velocity,f);var b=M(c.velocity,l);c.velocity.y=y;var z=160-b;if(z>0){var O=Math.min(10*s*160,z);p(c.velocity,l,O)}}var P=Object.assign(bn,o.position);if(P.y+=52,t(s,Re(o,v))){var F=fe();Object.assign(F.position,P),te(F,v.position);var A=Ki(F);g(w(Object.assign(A.velocity,D),F.quaternion),400),oe(n,F),A.collide=e=>{if(e.isEnemy)return!1;e===v&&ze(),Me(F.position),se(n,F)}}})));return o.isEnemy=!0,o.isPhantom=!0,Yr(o,"collide",(r=>{4===Ki(r).physics&&(e=2)})),o})();l(c.position,V(-160,150),V(128,32),V(-512,-640)),oe(n,c)}if(Pe(e)){var y=(()=>{var e=0,r=m(),i=m(),a=m(),t=nn(),o=Jr(1.3),s=V(64,128),c=we(ye(Xi(pe(),2),2),be((m=>{0===e&&Re(c,v)&&(e=2);var l=Ki(c);g(Object.assign(r,l.velocity),-.5);var y=je(c,v),u=2===e||Re(c,v)?h(gn,v.position,c.position):d(gn,0);j(u),E(u)&&(Z(fn,S,Math.atan2(u.x,u.z)),Q(c.quaternion,fn,Math.PI*m),R(Object.assign(bn,u),400));var f=l.velocity.y;if(f<=32&&(Object.assign(i,c.position),Object.assign(a,i),a.y-=32,on(le,l,t,i,a),1!==t.fraction)){var b=Math.max(16,.5*-f);r.y+=b*(1-t.fraction)}if(0!==y&&F(c.position,v.position)>s){var z=E(l.velocity),O=Math.max(z,20),P=Math.max(z-.3*O*m,0);R(l.velocity,P);var A=400-M(l.velocity,u);if(A>0){var T=Math.min(10*m*400,A);p(l.velocity,u,T)}}var C=Object.assign(bn,c.position);if(o(m,Re(c,v))){var _=fe();Object.assign(_.position,C),te(_,v.position);var L=Ki(_);g(w(Object.assign(L.velocity,D),_.quaternion),400),oe(n,_),L.collide=e=>{if(e.isEnemy)return!1;e===v&&ze(),Me(_.position),se(n,_)}}x(l.velocity,r)})));return c.isEnemy=!0,c.isScanner=!0,Yr(c,"collide",(r=>{4===Ki(r).physics&&(e=2)})),c})();l(y.position,V(-160,160),V(128,32),V(-512,-720)),oe(n,y)}}))),addEventListener("mousedown",(()=>hn=!0)),addEventListener("mouseup",(()=>hn=!1)),{ambient:a,directional:t}})(0,Cn,In),kn=wn(An,Fn,Pn),Un=wn(An,On,Rn),Nn=En(An,kn),qn=jn(An,kn),Vn=En(An,Un),Hn=jn(An,Un),Gn=An.createTexture();An.bindTexture(An.TEXTURE_2D,Gn),An.texImage2D(An.TEXTURE_2D,0,An.RGBA8,1024,1024,0,An.RGBA,An.UNSIGNED_BYTE,null),An.texParameteri(An.TEXTURE_2D,An.TEXTURE_MAG_FILTER,An.NEAREST),An.texParameteri(An.TEXTURE_2D,An.TEXTURE_MIN_FILTER,An.NEAREST),An.texParameteri(An.TEXTURE_2D,An.TEXTURE_WRAP_S,An.CLAMP_TO_EDGE),An.texParameteri(An.TEXTURE_2D,An.TEXTURE_WRAP_T,An.CLAMP_TO_EDGE);var Xn=An.createFramebuffer();An.bindFramebuffer(An.FRAMEBUFFER,Xn),An.framebufferTexture2D(An.FRAMEBUFFER,An.COLOR_ATTACHMENT0,An.TEXTURE_2D,Gn,0);var Kn=An.createRenderbuffer();An.bindRenderbuffer(An.RENDERBUFFER,Kn),An.renderbufferStorage(An.RENDERBUFFER,An.DEPTH_COMPONENT16,1024,1024),An.framebufferRenderbuffer(An.FRAMEBUFFER,An.DEPTH_ATTACHMENT,An.RENDERBUFFER,Kn);var Zn,Yn=1/60,Qn=Yn,Jn=new WeakMap,$n=(e,r,i,n)=>{var a=Jn.get(i)||{};Jn.set(i,a);var t=a[e]||((e,r)=>{var i=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,r,e.STATIC_DRAW),i})(An,i[e]);a[e]=t,((e,r,i,n)=>{e.bindBuffer(e.ARRAY_BUFFER,i),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,n,e.FLOAT,!1,0,0)})(An,r,t,n)},ea=new WeakMap,ra=e=>{var r,i,n,a=ea.get(e)||(i=[],n=[],(r=e).faces.map((e=>{i.push(r.vertices[e.a],r.vertices[e.b],r.vertices[e.c]);var{color:a,vertexColors:t}=e;3===t.length?n.push(...t):n.push(a,a,a)})),{position:v(new Float32Array(3*i.length),i),color:v(new Float32Array(3*n.length),n)});return ea.set(e,a),a},ia=m(),na=m(),aa=()=>{me(Cn),In.matrixWorldInverse.set(In.matrixWorld),N(In.matrixWorldInverse),An.useProgram(Un),An.bindFramebuffer(An.FRAMEBUFFER,Xn),An.viewport(0,0,1024,1024),An.clearColor(1,1,1,1),An.clear(An.COLOR_BUFFER_BIT|An.DEPTH_BUFFER_BIT),An.frontFace(An.CW),ge(Bn.shadow,Bn),he(Bn.shadow.camera),ve(Cn,(e=>{e.visible&&e.geometry&&e.castShadow&&(e=>{var{geometry:r}=e;zn(An,Hn.modelViewMatrix,U(e.modelViewMatrix,Bn.shadow.camera.matrixWorldInverse,e.matrixWorld)),zn(An,Hn.projectionMatrix,Bn.shadow.camera.projectionMatrix);var i=ra(r);$n("position",Vn.position,i,3),An.drawArrays(An.TRIANGLES,0,i.position.length/3)})(e)})),An.bindFramebuffer(An.FRAMEBUFFER,null),An.useProgram(kn),An.viewport(0,0,canvas.width,canvas.height),An.clearColor(0,0,0,0),An.clear(An.COLOR_BUFFER_BIT|An.DEPTH_BUFFER_BIT),An.frontFace(An.CCW),Mn(An,qn.ambient,Wn),T(na,Bn.matrixWorld),T(ia,Bn.target.matrixWorld),((e,r)=>{var{x:i,y:n,z:a}=e;e.x=r[0]*i+r[4]*n+r[8]*a,e.y=r[1]*i+r[5]*n+r[9]*a,e.z=r[2]*i+r[6]*n+r[10]*a,j(e)})(u(na,ia),In.matrixWorldInverse);var e=g(Object.assign(ia,Bn.color),Bn.intensity);Mn(An,qn["directionalLight.direction"],na),Mn(An,qn["directionalLight.color"],e),zn(An,qn.directionalShadowMatrix,Bn.shadow.matrix),ve(Cn,(e=>{e.visible&&e.geometry&&e.material&&(e=>{var{geometry:r,material:i}=e;An.uniform1i(qn.fog,i.fog),Mn(An,qn.fogColor,Cn.fogColor),An.uniform1f(qn.fogNear,Cn.fogNear),An.uniform1f(qn.fogFar,Cn.fogFar),Mn(An,qn.diffuse,i.color),Mn(An,qn.specular,i.specular),An.uniform1f(qn.shininess,i.shininess),Mn(An,qn.emissive,i.emissive),An.uniform1i(qn.receiveShadow,e.receiveShadow),zn(An,qn.modelMatrix,e.matrixWorld),zn(An,qn.modelViewMatrix,U(e.modelViewMatrix,In.matrixWorldInverse,e.matrixWorld)),zn(An,qn.projectionMatrix,In.projectionMatrix);var n=ra(r);$n("position",Nn.position,n,3),$n("color",Nn.color,n,3),An.drawArrays(An.TRIANGLES,0,n.position.length/3)})(e)}))},ta=()=>{(()=>{var e=.001*(performance.now()||0);Zn||(Zn=e);var r=Math.min(e-Zn,.1);for(Qn+=r,Zn=e;Qn>=Yn;)ve(Cn,(e=>{ze(e,Yn,Cn)})),Qn-=Yn})(),aa(),Tn&&requestAnimationFrame(ta)},oa=(e,r)=>{canvas.width=e*devicePixelRatio,canvas.height=r*devicePixelRatio,canvas.style.width=e+"px",canvas.style.height=r+"px",An.viewport(0,0,canvas.width,canvas.height),In.aspect=e/r,ye(In)};oa(innerWidth,innerHeight),ta(),addEventListener("resize",(()=>{oa(innerWidth,innerHeight),aa()})),addEventListener("keypress",(e=>{"KeyP"===e.code&&((Tn=!Tn)?ta():document.exitPointerLock())})),addEventListener("click",(()=>{Tn||(Tn=!0,ta())}));
